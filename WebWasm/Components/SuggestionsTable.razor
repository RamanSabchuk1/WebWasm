@using Microsoft.AspNetCore.Components.QuickGrid
@using WebWasm.Models
@using WebWasm.Services

<div class="data-grid-container">
	<div class="data-grid-search">
		<input type="text" 
			   placeholder="Search..." 
			   @bind="_searchText" 
			   @bind:event="oninput"
			   class="search-input" />
	</div>

	@if (_hasItems)
	{
		<div class="data-grid-scroll">
			<QuickGrid Items="@FilteredSuggestions" Pagination="@_pagination" class="data-grid">
				<PropertyColumn Property="@(s => s.Suggestion.Name)" Title="Name" Sortable="true" />
				<PropertyColumn Property="@(s => s.GetUserName())" Title="User" Sortable="true" />
				<TemplateColumn Title="Data" Sortable="false">
					<div class="data-cell">
						@if (context.Suggestion.Data.Count > 0)
						{
							<button class="btn-expand" @onclick="() => ToggleExpand(context.Suggestion.Id)">
								@(IsExpanded(context.Suggestion.Id) ? "▼" : "▶") @context.Suggestion.Data.Count item(s)
							</button>
							@if (IsExpanded(context.Suggestion.Id))
							{
								<div class="data-expanded">
									@foreach (var kvp in context.Suggestion.Data)
									{
										<div class="data-item">
											<span class="data-key">@kvp.Key:</span>
											<span class="data-value">@kvp.Value</span>
										</div>
									}
								</div>
							}
						}
						else
						{
							<span class="text-muted">No data</span>
						}
					</div>
				</TemplateColumn>
				<PropertyColumn Property="@(s => s.Suggestion.Created)" Title="Created" Format="yyyy-MM-dd HH:mm" Sortable="true" />
				<TemplateColumn Title="Applied" Sortable="false">
					@if (context.Suggestion.Applied.HasValue)
					{
						<span class="status-badge status-applied">@context.Suggestion.Applied.Value.ToString("yyyy-MM-dd HH:mm")</span>
					}
					else
					{
						<span class="status-badge status-pending">Pending</span>
					}
				</TemplateColumn>
				<TemplateColumn Title="Actions" Sortable="false">
					<button class="btn-action" 
							disabled="@context.Suggestion.Applied.HasValue"
							@onclick="() => OnApply.InvokeAsync(context.Suggestion.Id)">
						@(context.Suggestion.Applied.HasValue ? "Applied" : "Apply")
					</button>
				</TemplateColumn>
			</QuickGrid>
		</div>

		<div class="data-grid-pagination">
			<CustomPaginator State="@_pagination" />
		</div>
	}
	else
	{
		<div class="empty-state">
			<p>No suggestions available</p>
		</div>
	}
</div>
