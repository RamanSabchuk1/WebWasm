@using Microsoft.AspNetCore.Components.QuickGrid
@using WebWasm.Models
@using WebWasm.Services

<div class="data-grid-container">
	<div class="data-grid-search">
		<input type="text" 
			   placeholder="Search..." 
			   @bind="_searchText" 
			   @bind:event="oninput"
			   class="search-input" />
	</div>

	@if (_hasItems)
	{
		<div class="data-grid-scroll">
			<QuickGrid Items="@FilteredDevices" Pagination="@_pagination" class="data-grid">
				<PropertyColumn Property="@(d => d.DeviceToken.Device)" Title="Device" Sortable="true" />
				<PropertyColumn Property="@(d => d.GetUserName())" Title="User" Sortable="true" />
				<TemplateColumn Title="Token" Sortable="false">
					<div class="token-cell">
						<button class="btn-expand" @onclick="() => ToggleExpand(context.DeviceToken.Id)">
							@(IsExpanded(context.DeviceToken.Id) ? "â–¼" : "â–¶") Show Token
						</button>
						@if (IsExpanded(context.DeviceToken.Id))
						{
							<div class="token-expanded">
								<code class="token-value">@context.DeviceToken.Token</code>
								<button class="btn-copy" @onclick="() => CopyToClipboard(context.DeviceToken.Token)" title="Copy to clipboard">ðŸ“‹</button>
							</div>
						}
					</div>
				</TemplateColumn>
				<TemplateColumn Title="Additional Data" Sortable="false">
					<div class="data-cell">
						@if (context.DeviceToken.AdditionalData?.Count > 0)
						{
							<button class="btn-expand" @onclick="() => ToggleDataExpand(context.DeviceToken.Id)">
								@(IsDataExpanded(context.DeviceToken.Id) ? "â–¼" : "â–¶") @context.DeviceToken.AdditionalData.Count item(s)
							</button>
							@if (IsDataExpanded(context.DeviceToken.Id))
							{
								<div class="data-expanded">
									@foreach (var kvp in context.DeviceToken.AdditionalData)
									{
										<div class="data-item">
											<span class="data-key">@kvp.Key:</span>
											<span class="data-value">@kvp.Value</span>
										</div>
									}
								</div>
							}
						}
						else
						{
							<span class="text-muted">No data</span>
						}
					</div>
				</TemplateColumn>
				<TemplateColumn Title="Actions" Sortable="false">
					<button class="btn-action btn-unbind" 
							@onclick="() => OnUnbind.InvokeAsync((context.DeviceToken.Token, context.DeviceToken.UserInfoId))">
						Unbind
					</button>
				</TemplateColumn>
			</QuickGrid>
		</div>

		@if (_pagination.TotalItemCount.HasValue && _pagination.TotalItemCount.Value > _pagination.ItemsPerPage)
		{
			<div class="data-grid-pagination">
				<CustomPaginator State="@_pagination" />
			</div>
		}
	}
	else
	{
		<div class="empty-state">
			<p>No devices registered yet</p>
		</div>
	}
</div>
