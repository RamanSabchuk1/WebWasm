@using Microsoft.AspNetCore.Components.QuickGrid
@using WebWasm.Models

<div class="data-grid-container">
	<div class="data-grid-search">
		<input type="text"
			   placeholder="Search companies by name, UNP, email, or address..."
			   @bind="_searchText"
			   @bind:event="oninput"
			   class="search-input" />
	</div>

	@if (_hasItems)
	{
		<div class="data-grid-scroll">
			<QuickGrid Items="@FilteredCompanies" Pagination="@_pagination" class="data-grid">
				<TemplateColumn Title="Company" Sortable="false">
					<div class="company-cell">
						<button class="btn-expand" @onclick="() => ToggleExpand(context.Id)">
							@(IsExpanded(context.Id) ? "‚ñº" : "‚ñ∂")
						</button>
						<div class="company-info">
							<div class="company-name">@context.LegalName</div>
							<div class="company-unp">UNP: @context.UNP</div>
						</div>
					</div>

					@if (IsExpanded(context.Id))
					{
						<div class="company-expanded">
							<!-- Basic Info Section -->
							<div class="info-section">
								<h4>Company Information</h4>
								<div class="info-grid">
									<div class="info-item">
										<span class="info-label">Legal Address:</span>
										<span class="info-value">@context.LegalAddress</span>
									</div>
									<div class="info-item">
										<span class="info-label">Corporate Email:</span>
										<span class="info-value">
											@context.CorporateEmail
											@if (context.EmailVerified)
											{
												<span class="badge badge-verified">‚úì Verified</span>
											}
											else
											{
												<span class="badge badge-unverified">‚úó Not Verified</span>
											}
										</span>
									</div>
									<div class="info-item">
										<span class="info-label">Status:</span>
										<span class="info-value">
											@if (context.IsActive)
											{
												<span class="badge badge-active">Active</span>
											}
											else
											{
												<span class="badge badge-inactive">Inactive</span>
											}
										</span>
									</div>
								</div>
							</div>

							<!-- Company Info Section -->
							@if (context.CompanyInfo is not null)
							{
								<div class="info-section">
									<h4>Operational Details</h4>
									<div class="info-grid">
										<div class="info-item">
											<span class="info-label">Legal Type:</span>
											<span class="info-value">@context.CompanyInfo.LegalType</span>
										</div>
										<div class="info-item">
											<span class="info-label">Location:</span>
											<span class="info-value location">
												üìç @context.CompanyInfo.Location.Latitude.ToString("F6"), @context.CompanyInfo.Location.Longitude.ToString("F6")
											</span>
										</div>
										<div class="info-item">
											<span class="info-label">Working Hours:</span>
											<span class="info-value">
												@FormatTimeSpan(context.CompanyInfo.StartWorkingHours) - @FormatTimeSpan(context.CompanyInfo.EndWorkingHours)
											</span>
										</div>
										@if (context.CompanyInfo.ContactPhones.Count > 0)
										{
											<div class="info-item">
												<span class="info-label">Contact Phones:</span>
												<span class="info-value">
													@foreach (var phone in context.CompanyInfo.ContactPhones)
													{
														<span class="phone-badge">üìû @phone</span>
													}
												</span>
											</div>
										}
										@if (!string.IsNullOrEmpty(context.CompanyInfo.Photo))
										{
											<div class="info-item full-width">
												<span class="info-label">Photo:</span>
												<div class="company-photo">
													<img src="@context.CompanyInfo.Photo" alt="@context.LegalName" />
												</div>
											</div>
										}
									</div>
								</div>
							}

							<!-- Bank Account Section -->
							@if (context.BankAccount is not null)
							{
								<div class="info-section">
									<h4>Bank Account</h4>
									<div class="info-grid">
										<div class="info-item">
											<span class="info-label">Bank Number:</span>
											<span class="info-value bank-number">@context.BankAccount.BankNumber</span>
										</div>
										<div class="info-item">
											<span class="info-label">BIC:</span>
											<span class="info-value">@context.BankAccount.BIC</span>
										</div>
									</div>
								</div>
							}
						</div>
					}
				</TemplateColumn>

				<PropertyColumn Property="@(c => c.CorporateEmail)" Title="Email" Sortable="true" />

				<TemplateColumn Title="Status" Sortable="false">
					@if (context.IsActive)
					{
						<span class="status-badge status-active">Active</span>
					}
					else
					{
						<span class="status-badge status-inactive">Inactive</span>
					}
				</TemplateColumn>

				<TemplateColumn Title="Actions" Sortable="false">
					<button class="btn-action @(context.IsActive ? "btn-deactivate" : "btn-activate")"
							@onclick="() => OnToggleActive.InvokeAsync((context.Id, !context.IsActive))">
						@(context.IsActive ? "üîí Deactivate" : "‚úÖ Activate")
					</button>
				</TemplateColumn>
			</QuickGrid>
		</div>

		@if (_pagination.TotalItemCount.HasValue && _pagination.TotalItemCount.Value > _pagination.ItemsPerPage)
		{
			<div class="data-grid-pagination">
				<CustomPaginator State="@_pagination" />
			</div>
		}
	}
	else
	{
		<div class="empty-state">
			<p>No companies available</p>
		</div>
	}
</div>
